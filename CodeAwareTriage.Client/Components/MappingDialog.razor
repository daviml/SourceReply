@using CodeAwareTriage.Client.Models

<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
  <div class="bg-[#1a1a24] w-full max-w-lg rounded-2xl shadow-2xl border border-[#2d2d3d] overflow-hidden">
    <div class="px-6 py-4 border-b border-[#2d2d3d]">
      <h3 class="text-xl font-semibold text-white">Mapeamento de Colunas</h3>
      <p class="text-sm text-gray-400 mt-1">Identifique as colunas vitais do seu Excel para análise.</p>
    </div>
    
    <div class="p-6 space-y-4">
      
      <div>
        <label class="block text-xs font-bold text-gray-400 uppercase mb-1">ID / Identificador</label>
        <select @bind="Mapping.IdColumn" class="w-full bg-[#0d0d12] border border-[#3f3f5a] rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#594ae2]">
            <option value="">Selecione uma coluna...</option>
            @foreach (var h in Headers) { <option value="@h">@h</option> }
        </select>
      </div>

      <div>
        <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Descrição do Problema</label>
        <select @bind="Mapping.DescriptionColumn" class="w-full bg-[#0d0d12] border border-[#3f3f5a] rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#594ae2]">
             <option value="">Selecione uma coluna...</option>
             @foreach (var h in Headers) { <option value="@h">@h</option> }
        </select>
      </div>

      <div>
        <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Status Atual</label>
        <select @bind="Mapping.StatusColumn" class="w-full bg-[#0d0d12] border border-[#3f3f5a] rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#594ae2]">
            <option value="">Selecione uma coluna...</option>
            @foreach (var h in Headers) { <option value="@h">@h</option> }
        </select>
      </div>

       <div>
        <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Prioridade (Opcional)</label>
        <select @bind="Mapping.PriorityColumn" class="w-full bg-[#0d0d12] border border-[#3f3f5a] rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#594ae2]">
             <option value="">Selecione uma coluna...</option>
            @foreach (var h in Headers) { <option value="@h">@h</option> }
        </select>
      </div>

       <div>
        <label class="block text-xs font-bold text-gray-400 uppercase mb-1">Data Abertura (Opcional)</label>
        <select @bind="Mapping.DateColumn" class="w-full bg-[#0d0d12] border border-[#3f3f5a] rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#594ae2]">
             <option value="">Selecione uma coluna...</option>
            @foreach (var h in Headers) { <option value="@h">@h</option> }
        </select>
      </div>

    </div>

    <div class="px-6 py-4 bg-[#21212c] flex justify-end gap-3">
      <button @onclick="OnCancel" class="px-4 py-2 text-gray-400 hover:text-white font-medium transition-colors">
        Cancelar
      </button>
      <button @onclick="HandleConfirm" class="px-6 py-2 bg-[#594ae2] hover:bg-[#4a3bc1] text-white rounded-lg font-bold shadow-lg shadow-purple-900/20 transition-all">
        Confirmar Mapeamento
      </button>
    </div>
  </div>
</div>

@code {
    [Parameter] public List<string> Headers { get; set; } = new();
    [Parameter] public EventCallback<ColumnMapping> OnConfirm { get; set; }
    [Parameter] public EventCallback OnCancel { get; set; }

    public ColumnMapping Mapping { get; set; } = new();

    protected override void OnParametersSet()
    {
        if (Headers.Count > 0)
        {
             // Simple auto-assign for demo
             if(string.IsNullOrEmpty(Mapping.IdColumn)) Mapping.IdColumn = Headers.ElementAtOrDefault(0) ?? "";
             if(string.IsNullOrEmpty(Mapping.DescriptionColumn)) Mapping.DescriptionColumn = Headers.ElementAtOrDefault(1) ?? "";
             if(string.IsNullOrEmpty(Mapping.StatusColumn)) Mapping.StatusColumn = Headers.ElementAtOrDefault(2) ?? "";
        }
    }

    private async Task HandleConfirm()
    {
        await OnConfirm.InvokeAsync(Mapping);
    }
}
